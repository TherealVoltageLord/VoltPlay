<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoltPlay | Gaming Dashboard</title>
    <meta name="description" content="Professional gaming platform with skill-based games">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        :root {
            --primary: #6e00ff;
            --primary-light: #8e2bff;
            --secondary: #ff00a8;
            --secondary-light: #ff2bbd;
            --dark: #1a1a2e;
            --darker: #121223;
            --light: #f8f9fa;
            --success: #00b894;
            --success-light: #00d3a9;
            --danger: #dc3545;
            --danger-light: #ff4757;
            --warning: #fdcb6e;
            --warning-light: #ffeaa7;
            --info: #0984e3;
            --card-bg: rgba(30, 30, 50, 0.85);
            --card-bg-solid: #1e1e32;
            --card-border: rgba(255, 255, 255, 0.12);
            --text-primary: rgba(255, 255, 255, 0.92);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark), #16213e);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Navbar */
        .navbar {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--card-border);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        .nav-link:hover, .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .user-avatar:hover {
            transform: scale(1.1);
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-bg-solid);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 10px 0;
            min-width: 200px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 101;
        }
        
        .user-profile:hover .user-dropdown {
            opacity: 1;
            visibility: visible;
        }
        
        .dropdown-item {
            padding: 10px 20px;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-divider {
            height: 1px;
            background: var(--card-border);
            margin: 8px 0;
        }
        
        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 25px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--card-border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(110, 0, 255, 0.1), rgba(255, 0, 168, 0.1));
            opacity: 0;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .coins .stat-icon { color: var(--warning); }
        .points .stat-icon { color: var(--success); }
        .streak .stat-icon { color: var(--secondary); }
        .level .stat-icon { color: var(--primary); }
        
        .stat-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .stat-progress {
            margin-top: 15px;
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .coins .progress-fill { background: var(--warning); }
        .points .progress-fill { background: var(--success); }
        .streak .progress-fill { background: var(--secondary); }
        .level .progress-fill { background: var(--primary); }
        
        .progress-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            box-shadow: 0 5px 15px rgba(110, 0, 255, 0.4);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: var(--success-light);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }
        
        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background: var(--warning-light);
            box-shadow: 0 5px 15px rgba(253, 203, 110, 0.4);
        }
        
        .btn-disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        /* Games Section */
        .section-title {
            font-size: 1.5rem;
            margin: 30px 0 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
      .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.game-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    border: 1px solid var(--card-border);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
    overflow: hidden; /* Moved from .game-image to parent */
    display: flex; /* Added for better flex layout */
    flex-direction: column; /* Stack children vertically */
}

.game-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}

.game-image {
    height: 180px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    font-size: 4rem;
    color: white;
}

/* Add aspect ratio for images */
.game-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 16/9; /* Helps maintain consistent image proportions */
}

.game-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--danger);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: bold;
    z-index: 2; /* Ensure badge appears above overlay */
}

.play-overlay {
    position: absolute;
    inset: 0; /* Modern alternative to top/left/right/bottom: 0 */
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: var(--transition);
    z-index: 1;
}

.play-text {
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.game-info {
    padding: 20px;
    flex-grow: 1; /* Makes info section fill remaining space */
}

.game-title {
    font-size: 1.2rem;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.game-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.game-rating {
    display: flex;
    align-items: center;
    gap: 4px;
    color: var(--warning);
}

.game-desc {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.5;
    margin-bottom: 15px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    min-height: 4.5em; /* Ensure consistent height even with less text */
}

.game-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
}

.game-stat {
    display: flex;
    align-items: center;
    gap: 4px;
    color: var(--text-secondary);
}

/* Add responsive adjustments */
@media (max-width: 768px) {
    .games-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .game-image {
        height: 150px;
        font-size: 3rem;
    }
}

@media (hover: none) {
    .game-card:hover {
        transform: none;
        box-shadow: none;
    }
}
        /* Leaderboard */
        .leaderboard-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--card-border);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px 15px;
            color: var(--text-secondary);
            font-weight: 500;
            border-bottom: 1px solid var(--card-border);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--card-border);
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .rank {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .rank-1 { color: var(--warning); }
        .rank-2 { color: white; }
        .rank-3 { color: var(--secondary); }
        
        .player {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .player-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .points {
            color: var(--success);
            font-weight: 500;
        }
        
        /* Notifications */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--card-bg-solid);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--card-border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            transition: var(--transition);
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            color: white;
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--card-border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .container {
                padding: 20px;
            }
            
            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .navbar {
                padding: 12px 15px;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .section-actions {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-bolt logo-icon"></i>
            <span>VoltPlay</span>
        </div>
        
        <div class="nav-links">
            <a href="#" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a>
            <a href="#" class="nav-link"><i class="fas fa-gamepad"></i> Games</a>
            <a href="#" class="nav-link"><i class="fas fa-trophy"></i> Leaderboards</a>
            <a href="#" class="nav-link"><i class="fas fa-store"></i> Shop</a>
            <a href="#" class="nav-link"><i class="fas fa-users"></i> Community</a>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="user-avatar">
                <span id="avatar-initial">U</span>
                <div class="notification-badge" id="notification-badge">3</div>
            </div>
            <span id="username">Username</span>
            
            <div class="user-dropdown">
                <a href="#" class="dropdown-item"><i class="fas fa-user"></i> Profile</a>
                <a href="#" class="dropdown-item"><i class="fas fa-cog"></i> Settings</a>
                <a href="#" class="dropdown-item"><i class="fas fa-bell"></i> Notifications</a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card coins">
                <div class="stat-header">
                    <div>
                        <div class="stat-title"><i class="fas fa-coins"></i> Coins</div>
                        <div class="stat-value" id="coins">0</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-coins"></i></div>
                </div>
                <div class="stat-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="coins-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Level 1</span>
                        <span>0/1000</span>
                    </div>
                </div>
                <button class="btn btn-warning" id="daily-bonus">
                    <i class="fas fa-calendar-day"></i> Daily Bonus
                </button>
            </div>
            
            <div class="stat-card points">
                <div class="stat-header">
                    <div>
                        <div class="stat-title"><i class="fas fa-trophy"></i> Points</div>
                        <div class="stat-value" id="points">0</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                </div>
                <div class="stat-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="points-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Rank: Newbie</span>
                        <span>0/5000</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-card streak">
                <div class="stat-header">
                    <div>
                        <div class="stat-title"><i class="fas fa-fire"></i> Streak</div>
                        <div class="stat-value" id="streak">0 days</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-fire"></i></div>
                </div>
                <div class="stat-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="streak-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Current streak</span>
                        <span>Best: 0 days</span>
                    </div>
                </div>
                <button class="btn btn-primary" id="weekly-bonus">
                    <i class="fas fa-calendar-week"></i> Weekly Bonus
                </button>
            </div>
            
            <div class="stat-card level">
                <div class="stat-header">
                    <div>
                        <div class="stat-title"><i class="fas fa-level-up-alt"></i> Level</div>
                        <div class="stat-value" id="level">1</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-level-up-alt"></i></div>
                </div>
                <div class="stat-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="level-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Experience</span>
                        <span>0/1000</span>
                    </div>
                </div>
                <button class="btn btn-success" id="claim-rewards">
                    <i class="fas fa-gift"></i> Claim Rewards
                </button>
            </div>
        </div>
        
        <!-- Games Section -->
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-gamepad"></i> Featured Games</h2>
            <div class="section-actions">
                <button class="btn" id="view-all-games">
                    <i class="fas fa-list"></i> View All
                </button>
                <button class="btn" id="refresh-games">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
        
        <div class="games-grid" id="games-container">
            <!-- Games will be inserted here by JavaScript -->
        </div>
        
        <!-- Leaderboard -->
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-medal"></i> Global Leaderboard</h2>
            <div class="section-actions">
                <button class="btn" id="friends-leaderboard">
                    <i class="fas fa-user-friends"></i> Friends
                </button>
                <button class="btn" id="monthly-leaderboard">
                    <i class="fas fa-calendar-alt"></i> Monthly
                </button>
            </div>
        </div>
        
        <div class="leaderboard-container">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Level</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody id="leaderboard">
                    <!-- Leaderboard will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Bonus Claim Modal -->
    <div class="modal" id="bonus-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="bonus-modal-title">Daily Bonus</h3>
                <button class="modal-close" id="close-bonus-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="bonus-content">
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 5rem; color: var(--warning);">
                            <i class="fas fa-gift"></i>
                        </div>
                        <h3 style="margin: 15px 0 10px;">Claim Your Bonus!</h3>
                        <p id="bonus-description">You've earned a daily bonus of <strong>50 coins</strong>!</p>
                        <div id="streak-info" style="margin-top: 20px; padding: 10px; background: rgba(255, 0, 168, 0.1); border-radius: 8px;">
                            <i class="fas fa-fire" style="color: var(--secondary);"></i>
                            <span>Current streak: <strong id="current-streak">1 day</strong></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-bonus">Maybe Later</button>
                <button class="btn btn-primary" id="claim-bonus">Claim Now</button>
            </div>
        </div>
    </div>
    
    <!-- Game Info Modal -->
    <div class="modal" id="game-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="game-modal-title">Game Title</h3>
                <button class="modal-close" id="close-game-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="game-modal-content">
                    <!-- Game content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-game">Close</button>
                <button class="btn btn-primary" id="play-game">Play Now</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
   // Configuration
const API_BASE_URL = 'https://voltagelord-volt-play-server.hf.space';
const API_ENDPOINTS = {
    AUTH_VERIFY: '/auth/verify',
    USER: '/user',
    GAMES: '/games',
    LEADERBOARD: '/leaderboard/global',
    DAILY_BONUS: '/daily-bonus',
    WEEKLY_BONUS: '/weekly-bonus',
    LEVEL_REWARDS: '/level-rewards',
    FRIENDS_LEADERBOARD: '/leaderboard/friends',
    MONTHLY_LEADERBOARD: '/leaderboard/monthly'
};
const DEFAULT_AVATAR_COLORS = ['#6e00ff', '#ff00a8', '#00b894', '#0984e3', '#fdcb6e'];
const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes

// DOM Elements
const userAvatar = document.getElementById('user-avatar');
const avatarInitial = document.getElementById('avatar-initial');
const usernameEl = document.getElementById('username');
const coinsEl = document.getElementById('coins');
const pointsEl = document.getElementById('points');
const streakEl = document.getElementById('streak');
const levelEl = document.getElementById('level');
const gamesContainer = document.getElementById('games-container');
const leaderboardEl = document.getElementById('leaderboard');
const notificationBadge = document.getElementById('notification-badge');

// Progress bars
const coinsProgress = document.getElementById('coins-progress');
const pointsProgress = document.getElementById('points-progress');
const streakProgress = document.getElementById('streak-progress');
const levelProgress = document.getElementById('level-progress');

// Buttons
const dailyBonusBtn = document.getElementById('daily-bonus');
const weeklyBonusBtn = document.getElementById('weekly-bonus');
const claimRewardsBtn = document.getElementById('claim-rewards');
const viewAllGamesBtn = document.getElementById('view-all-games');
const refreshGamesBtn = document.getElementById('refresh-games');
const friendsLeaderboardBtn = document.getElementById('friends-leaderboard');
const monthlyLeaderboardBtn = document.getElementById('monthly-leaderboard');
const logoutBtn = document.getElementById('logout-btn');

// Modals
const bonusModal = document.getElementById('bonus-modal');
const bonusModalTitle = document.getElementById('bonus-modal-title');
const bonusDescription = document.getElementById('bonus-description');
const currentStreakEl = document.getElementById('current-streak');
const claimBonusBtn = document.getElementById('claim-bonus');
const closeBonusModal = document.getElementById('close-bonus-modal');
const cancelBonusBtn = document.getElementById('cancel-bonus');

const gameModal = document.getElementById('game-modal');
const gameModalTitle = document.getElementById('game-modal-title');
const gameModalContent = document.getElementById('game-modal-content');
const playGameBtn = document.getElementById('play-game');
const closeGameModal = document.getElementById('close-game-modal');
const cancelGameBtn = document.getElementById('cancel-game');

// State
let userData = {
    id: '',
    username: 'Guest',
    email: '',
    avatar: '',
    coins: 0,
    points: 0,
    level: 1,
    xp: 0,
    streak: 0,
    bestStreak: 0,
    lastLogin: '',
    notifications: 0,
    isAdmin: false
};

let gamesData = [];
let leaderboardData = [];
let inactivityTimer;

// Initialize the app
document.addEventListener('DOMContentLoaded', async () => {
    setupEventListeners();
    await checkAuth();
    await Promise.all([
        loadUserData(),
        loadGames(),
        loadLeaderboard()
    ]);
    checkBonuses();
    updateUI();
    resetInactivityTimer();
});

// Authentication functions
async function checkAuth() {
    const token = localStorage.getItem('voltplay_token');
    const user = JSON.parse(localStorage.getItem('voltplay_user'));
    
    if (!token || !user) {
        redirectToLogin();
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.AUTH_VERIFY}`, {
            method: 'POST',
            headers: {
                'x-access-token': token
            }
        });
        
        if (!response.ok) {
            throw new Error('Invalid token');
        }
        
        const data = await response.json();
        userData = { ...userData, ...data.user };
        localStorage.setItem('voltplay_user', JSON.stringify(userData));
    } catch (error) {
        console.error('Authentication error:', error);
        clearAuthData();
        redirectToLogin();
    }
}

function clearAuthData() {
    localStorage.removeItem('voltplay_token');
    localStorage.removeItem('voltplay_user');
}

function redirectToLogin() {
    window.location.href = 'index.html';
}

// Data loading functions
async function loadUserData() {
    try {
        showLoadingState('.stat-value');
        
        const token = localStorage.getItem('voltplay_token');
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.USER}`, {
            headers: {
                'x-access-token': token
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        userData = {
            id: data.user.id,
            username: data.user.username,
            email: data.user.email,
            coins: data.user.coins,
            points: data.user.points,
            level: data.user.level || 1 + Math.floor(data.user.points / 1000),
            xp: data.user.points % 1000,
            streak: data.user.streak || 0,
            bestStreak: data.user.best_streak || 0,
            notifications: data.user.notification_count || 0,
            lastLogin: data.user.last_login || '',
            isAdmin: data.user.is_admin || false
        };
        
        localStorage.setItem('voltplay_user', JSON.stringify(userData));
    } catch (error) {
        console.error('Error loading user data:', error);
        showToast('Failed to load user data', 'error');
    }
}

async function loadGames() {
    try {
        showLoadingState('#games-container', 'Loading games...');
        
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.GAMES}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        gamesData = data.games || [];
    } catch (error) {
        console.error('Error loading games:', error);
        showToast('Failed to load games', 'error');
        gamesData = [];
    } finally {
        renderGames();
    }
}

async function loadLeaderboard() {
    try {
        showLoadingState('#leaderboard', 'Loading leaderboard...');
        
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.LEADERBOARD}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        leaderboardData = data.leaderboard || [];
    } catch (error) {
        console.error('Error loading leaderboard:', error);
        showToast('Failed to load leaderboard', 'error');
        leaderboardData = [];
    } finally {
        renderLeaderboard();
    }
}

async function checkBonuses() {
    try {
        const token = localStorage.getItem('voltplay_token');
        const today = new Date().toISOString().split('T')[0];
        
        // Check daily bonus
        const dailyResponse = await fetch(`${API_BASE_URL}/daily_logins?user_id=${userData.id}`, {
            headers: {
                'x-access-token': token
            }
        });
        
        if (dailyResponse.ok) {
            const dailyData = await dailyResponse.json();
            if (dailyData.last_login_date === today) {
                dailyBonusBtn.disabled = true;
                dailyBonusBtn.classList.remove('btn-warning');
            }
        }
        
        // Check weekly bonus
        const weeklyResponse = await fetch(`${API_BASE_URL}/weekly_streaks?user_id=${userData.id}`, {
            headers: {
                'x-access-token': token
            }
        });
        
        if (weeklyResponse.ok) {
            const weeklyData = await weeklyResponse.json();
            const lastClaimDate = new Date(weeklyData.last_claim_date);
            const currentWeekStart = new Date();
            currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay());
            
            if (lastClaimDate >= currentWeekStart) {
                weeklyBonusBtn.disabled = true;
                weeklyBonusBtn.classList.remove('btn-primary');
            }
        }
    } catch (error) {
        console.error('Error checking bonuses:', error);
    }
}

// Rendering functions
function renderGames() {
    gamesContainer.innerHTML = '';
    
    if (gamesData.length === 0) {
        gamesContainer.innerHTML = `
            <div class="no-games" style="grid-column: 1/-1; text-align: center; padding: 40px;">
                <i class="fas fa-gamepad" style="font-size: 3rem; color: var(--text-secondary);"></i>
                <h3 style="margin-top: 15px;">No games available</h3>
                <p>Check back later or try refreshing</p>
                <button class="btn btn-primary" onclick="loadGames()">
                    <i class="fas fa-sync-alt"></i> Refresh Games
                </button>
            </div>
        `;
        return;
    }
    
    gamesData.forEach(game => {
        const gameCard = document.createElement('div');
        gameCard.className = 'game-card';
        gameCard.dataset.gameId = game.id;
        
        gameCard.innerHTML = `
            <div class="game-image" style="background: ${getGameBackground(game.id)};">
                ${game.image_url ? 
                    `<img src="voltplay.jpg" alt="${game.name}" onerror="this.onerror=null;this.parentElement.innerHTML='${getGameIcon(game.id)}';">` : 
                    getGameIcon(game.id)
                }
                <div class="play-overlay">
                    <span class="play-text"><i class="fas fa-play"></i> Play Now</span>
                </div>
            </div>
            <div class="game-info">
                <h3 class="game-title">${getGameIcon(game.id)} ${game.name}</h3>
                <div class="game-meta">
                    <span class="game-rating">
                        <i class="fas fa-star"></i> ${game.rating?.toFixed(1) || '4.5'}
                    </span>
                    <span>${game.difficulty || 'Medium'}</span>
                </div>
                <p class="game-desc">${game.description || 'Test your skills in this exciting game!'}</p>
                <div class="game-stats">
                    <span class="game-stat">
                        <i class="fas fa-users"></i> ${game.players || '100+'} players
                    </span>
                    <span class="game-stat">
                        <i class="fas fa-trophy"></i> ${game.win_rate || '35'}% win rate
                    </span>
                </div>
            </div>
        `;
        
        gameCard.addEventListener('click', () => showGameModal(game));
        gamesContainer.appendChild(gameCard);
    });
}

function renderLeaderboard() {
    leaderboardEl.innerHTML = '';
    
    if (leaderboardData.length === 0) {
        leaderboardEl.innerHTML = `
            <tr>
                <td colspan="4" style="text-align: center; padding: 30px;">
                    No leaderboard data available
                </td>
            </tr>
        `;
        return;
    }
    
    leaderboardData.forEach((player, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <div class="rank ${index < 3 ? `rank-${index + 1}` : ''}">
                    <i class="fas fa-${getRankIcon(index + 1)}"></i> ${index + 1}
                </div>
            </td>
            <td>
                <div class="player">
                    <div class="player-avatar" style="background: ${getRandomColor()}">
                        ${player.username.charAt(0).toUpperCase()}
                    </div>
                    <span>${player.username}</span>
                </div>
            </td>
            <td>${player.level || 1}</td>
            <td class="points">${player.points}</td>
        `;
        leaderboardEl.appendChild(row);
    });
}

function updateUI() {
    avatarInitial.textContent = userData.username.charAt(0).toUpperCase();
    usernameEl.textContent = userData.username;
    coinsEl.textContent = userData.coins;
    pointsEl.textContent = userData.points;
    streakEl.textContent = `${userData.streak || 0} days`;
    levelEl.textContent = userData.level || 1;
    notificationBadge.textContent = userData.notifications || 0;
    notificationBadge.style.display = userData.notifications > 0 ? 'flex' : 'none';
    
    // Update progress bars
    coinsProgress.style.width = `${Math.min(100, (userData.coins / 1000) * 100)}%`;
    pointsProgress.style.width = `${Math.min(100, (userData.points / 5000) * 100)}%`;
    streakProgress.style.width = `${Math.min(100, (userData.streak / 7) * 100)}%`;
    levelProgress.style.width = `${Math.min(100, (userData.xp / 1000) * 100)}%`;
    
    // Update progress text
    document.querySelector('.coins .progress-text span:last-child').textContent = 
        `${userData.coins}/1000`;
    document.querySelector('.points .progress-text span:last-child').textContent = 
        `${userData.points}/5000`;
    document.querySelector('.streak .progress-text span:first-child').textContent = 
        `Current streak: ${userData.streak || 0} days`;
    document.querySelector('.level .progress-text span:last-child').textContent = 
        `${userData.xp || 0}/1000`;
}

// Bonus functions
async function claimDailyBonus() {
    try {
        setButtonLoading(dailyBonusBtn, 'Claiming...');
        
        const token = localStorage.getItem('voltplay_token');
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.DAILY_BONUS}`, {
            method: 'POST',
            headers: {
                'x-access-token': token,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to claim bonus');
        }
        
        const result = await response.json();
        
        // Update user data
        userData.coins += result.bonus_points;
        userData.streak = result.streak;
        userData.points += result.bonus_points || 0;
        
        // Update UI
        updateUI();
        showBonusModal('Daily Bonus', result.bonus_points, result.streak);
        showToast(`Daily bonus claimed! +${result.bonus_points} coins`, 'success');
        
    } catch (error) {
        console.error('Error claiming daily bonus:', error);
        showToast(error.message || 'Failed to claim daily bonus', 'error');
    } finally {
        resetButton(dailyBonusBtn, '<i class="fas fa-calendar-day"></i> Daily Bonus');
        dailyBonusBtn.disabled = true;
    }
}

async function claimWeeklyBonus() {
    try {
        setButtonLoading(weeklyBonusBtn, 'Claiming...');
        
        const token = localStorage.getItem('voltplay_token');
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.WEEKLY_BONUS}`, {
            method: 'POST',
            headers: {
                'x-access-token': token,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to claim bonus');
        }
        
        const result = await response.json();
        
        // Update user data
        userData.coins += result.bonus_coins;
        
        // Update UI
        updateUI();
        showBonusModal('Weekly Bonus', result.bonus_coins, result.current_week, true);
        showToast(`Weekly bonus claimed! +${result.bonus_coins} coins`, 'success');
        
    } catch (error) {
        console.error('Error claiming weekly bonus:', error);
        showToast(error.message || 'Failed to claim weekly bonus', 'error');
    } finally {
        resetButton(weeklyBonusBtn, '<i class="fas fa-calendar-week"></i> Weekly Bonus');
        weeklyBonusBtn.disabled = true;
    }
}

async function claimLevelRewards() {
    try {
        setButtonLoading(claimRewardsBtn, 'Claiming...');
        
        const token = localStorage.getItem('voltplay_token');
        const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.LEVEL_REWARDS}`, {
            method: 'POST',
            headers: {
                'x-access-token': token,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to claim rewards');
        }
        
        const result = await response.json();
        
        // Update user data
        userData.coins += result.coins;
        userData.points += result.points;
        userData.level = result.new_level;
        userData.xp = result.new_xp;
        
        // Update UI
        updateUI();
        showToast(`Level rewards claimed! +${result.coins} coins and +${result.points} points`, 'success');
        
    } catch (error) {
        console.error('Error claiming level rewards:', error);
        showToast(error.message || 'No rewards available to claim', 'info');
    } finally {
        resetButton(claimRewardsBtn, '<i class="fas fa-gift"></i> Claim Rewards');
    }
}

// Modal functions
function showBonusModal(title, amount, streak, isWeekly = false) {
    bonusModalTitle.textContent = title;
    bonusDescription.innerHTML = `You've earned <strong>${amount} ${isWeekly ? 'coins' : 'coins and points'}</strong>!`;
    
    if (isWeekly) {
        document.getElementById('streak-info').innerHTML = `
            <i class="fas fa-calendar-week" style="color: var(--primary);"></i>
            <span>Current streak: <strong>${streak} weeks</strong></span>
        `;
    } else {
        document.getElementById('streak-info').innerHTML = `
            <i class="fas fa-fire" style="color: var(--secondary);"></i>
            <span>Current streak: <strong>${streak} days</strong></span>
        `;
    }
    
    bonusModal.classList.add('active');
}

function showGameModal(game) {
    gameModalTitle.textContent = game.name;
    
    let modalContent = '';
    switch(game.id) {
        case 'coin_flip':
            modalContent = generateGameModalContent('coins', 'Coin Flip Challenge', game);
            break;
        case 'tic_tac_toe':
            modalContent = generateGameModalContent('times', 'Tic Tac Toe', game);
            break;
        case 'rock_paper_scissors':
            modalContent = generateGameModalContent('hand-rock', 'Rock Paper Scissors', game);
            break;
        case 'memory_game':
            modalContent = generateGameModalContent('brain', 'Memory Game', game);
            break;
        default:
            modalContent = generateGameModalContent('gamepad', game.name, game);
    }
    
    gameModalContent.innerHTML = modalContent;
    playGameBtn.dataset.gameId = game.id;
    gameModal.classList.add('active');
}

function generateGameModalContent(icon, title, game) {
    return `
        <div style="text-align: center;">
            <div style="font-size: 4rem; margin: 20px 0;">
                <i class="fas fa-${icon}"></i>
            </div>
            <h3 style="margin-bottom: 15px;">${title}</h3>
            <p>${game.description || 'Test your skills in this exciting game!'}</p>
            <p style="margin: 15px 0; color: var(--warning);">
                <i class="fas fa-info-circle"></i> ${game.win_rate || '35'}% chance to win
            </p>
            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                <p><strong>Rewards:</strong></p>
                <p><i class="fas fa-coins" style="color: var(--warning);"></i> ${game.reward_coins || '50-100'} coins for winning</p>
                <p><i class="fas fa-trophy" style="color: var(--success);"></i> ${game.reward_points || '20-40'} points for playing</p>
            </div>
        </div>
    `;
}

function launchSelectedGame() {
    const gameId = playGameBtn.dataset.gameId;
    gameModal.classList.remove('active');
    
    const gameRoutes = {
        'coin_flip': 'coinflip.html',
        'tic_tac_toe': 'ttt.html',
        'rock_paper_scissors': 'rps.html',
        'memory_game': 'memory.html'
    };
    
    const route = gameRoutes[gameId];
    if (route) {
        window.location.href = route;
    } else {
        showToast('Game not available', 'error');
    }
}

// Helper functions
function getGameBackground(gameId) {
    const backgrounds = {
        'coin_flip': 'linear-gradient(135deg, #f6d365 0%, #fda085 100%)',
        'tic_tac_toe': 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
        'rock_paper_scissors': 'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
        'memory_game': 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)'
    };
    return backgrounds[gameId] || 'linear-gradient(135deg, var(--primary), var(--secondary))';
}

function getGameIcon(gameId) {
    const icons = {
        'coin_flip': '<i class="fas fa-coins"></i>',
        'tic_tac_toe': '<i class="fas fa-times"></i>',
        'rock_paper_scissors': '<i class="fas fa-hand-rock"></i>',
        'memory_game': '<i class="fas fa-brain"></i>'
    };
    return icons[gameId] || '<i class="fas fa-gamepad"></i>';
}

function getRankIcon(rank) {
    if (rank === 1) return 'crown';
    if (rank <= 3) return 'medal';
    return 'hashtag';
}

function getRandomColor() {
    return DEFAULT_AVATAR_COLORS[Math.floor(Math.random() * DEFAULT_AVATAR_COLORS.length)];
}

function showToast(message, type = 'info') {
    const background = {
        info: 'linear-gradient(to right, var(--primary), var(--secondary))',
        success: 'linear-gradient(to right, var(--success), var(--success-light))',
        warning: 'linear-gradient(to right, var(--warning), var(--warning-light))',
        error: 'linear-gradient(to right, var(--danger), var(--danger-light))'
    }[type];
    
    Toastify({
        text: message,
        duration: 3000,
        close: true,
        gravity: "top",
        position: "right",
        stopOnFocus: true,
        style: {
            background: background,
            borderRadius: '8px',
            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.3)'
        }
    }).showToast();
}

function setButtonLoading(button, text) {
    button.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`;
    button.disabled = true;
}

function resetButton(button, html) {
    button.innerHTML = html;
    button.disabled = false;
}

function showLoadingState(selector, text = '') {
    const element = document.querySelector(selector);
    if (element) {
        element.innerHTML = text ? `<span class="spinner"></span> ${text}` : '<span class="spinner"></span>';
    }
}

// Session management
function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
        showToast('Session timed out due to inactivity', 'warning');
        logout();
    }, SESSION_TIMEOUT);
}

function logout() {
    clearAuthData();
    redirectToLogin();
}

// Event listeners
function setupEventListeners() {
    // Bonus buttons
    dailyBonusBtn.addEventListener('click', claimDailyBonus);
    weeklyBonusBtn.addEventListener('click', claimWeeklyBonus);
    claimRewardsBtn.addEventListener('click', claimLevelRewards);
    
    // Game buttons
    viewAllGamesBtn.addEventListener('click', () => {
        window.location.href = 'games.html';
    });
    
    refreshGamesBtn.addEventListener('click', async () => {
        setButtonLoading(refreshGamesBtn, 'Refreshing');
        await loadGames();
        resetButton(refreshGamesBtn, '<i class="fas fa-sync-alt"></i> Refresh');
    });
    
    // Leaderboard buttons
    friendsLeaderboardBtn.addEventListener('click', async () => {
        try {
            setButtonLoading(friendsLeaderboardBtn, 'Loading');
            
            const token = localStorage.getItem('voltplay_token');
            const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.FRIENDS_LEADERBOARD}`, {
                headers: {
                    'x-access-token': token
                }
            });
            
            if (!response.ok) {
                throw new Error('Failed to load friends leaderboard');
            }
            
            const data = await response.json();
            leaderboardData = data.leaderboard || [];
            renderLeaderboard();
            showToast('Showing friends leaderboard', 'success');
            
        } catch (error) {
            console.error('Error loading friends leaderboard:', error);
            showToast('Failed to load friends leaderboard', 'error');
        } finally {
            resetButton(friendsLeaderboardBtn, '<i class="fas fa-user-friends"></i> Friends');
        }
    });
    
    monthlyLeaderboardBtn.addEventListener('click', async () => {
        try {
            setButtonLoading(monthlyLeaderboardBtn, 'Loading');
            
            const response = await fetch(`${API_BASE_URL}${API_ENDPOINTS.MONTHLY_LEADERBOARD}`);
            
            if (!response.ok) {
                throw new Error('Failed to load monthly leaderboard');
            }
            
            const data = await response.json();
            leaderboardData = data.leaderboard || [];
            renderLeaderboard();
            showToast('Showing monthly leaderboard', 'success');
            
        } catch (error) {
            console.error('Error loading monthly leaderboard:', error);
            showToast('Failed to load monthly leaderboard', 'error');
        } finally {
            resetButton(monthlyLeaderboardBtn, '<i class="fas fa-calendar-alt"></i> Monthly');
        }
    });
    
    // Modal buttons
    closeBonusModal.addEventListener('click', () => bonusModal.classList.remove('active'));
    cancelBonusBtn.addEventListener('click', () => bonusModal.classList.remove('active'));
    claimBonusBtn.addEventListener('click', () => bonusModal.classList.remove('active'));
    
    closeGameModal.addEventListener('click', () => gameModal.classList.remove('active'));
    cancelGameBtn.addEventListener('click', () => gameModal.classList.remove('active'));
    playGameBtn.addEventListener('click', launchSelectedGame);
    
    // Logout
    logoutBtn.addEventListener('click', logout);
    
    // Activity listeners
    ['click', 'mousemove', 'keypress'].forEach(event => {
        window.addEventListener(event, resetInactivityTimer);
    });
    
    // Global error handling
    window.addEventListener('unhandledrejection', event => {
        console.error('Unhandled rejection:', event.reason);
        showToast('An unexpected error occurred', 'error');
    });
    
    window.addEventListener('error', event => {
        console.error('Error:', event.error);
        showToast('A system error occurred', 'error');
    });
}
</body>
</html>
